from configs.main_config import REFERRAL_PROGRAMM_CONFIG
from modules.bot.callbacks import how_to_callbacks
from math import ceil
import time
from datetime import date

how_ios = (
"üì± <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è iOS</b>:\n"
"1. –£—Å—Ç–∞–Ω–æ–≤–∏ V2Box –∏–∑ App Store.\n"
"2. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–µ—Ä–µ–π–¥–∏ –≤ Configs –∏ –Ω–∞–∂–º–∏ ‚Äú+‚Äù.\n"
"3. –°–∫–æ–ø–∏—Ä—É–π –∫–ª—é—á, –≤—ã–¥–∞–Ω–Ω—ã–π –≤ –±–æ—Ç–µ, –∏ –≤—ã–±–µ—Ä–∏ ‚Äú–ò–º–ø–æ—Ä—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞‚Äù.\n"
"4. –í—ã–±–µ—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∫–ª—é—á –Ω–∞–∂–∞—Ç–∏–µ–º –Ω–∞ –Ω–µ–≥–æ.\n"
"5. –ù–∞–∂–º–∏ ‚Äú–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è‚Äù."
)

how_android = (
"ü§ñ <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Android</b>:\n"
"1. –£—Å—Ç–∞–Ω–æ–≤–∏ Hiddify –∏–∑ Google Play –∏–ª–∏ —Å —Å–∞–π—Ç–∞ hiddify.com.\n"
"2. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏ ‚Äú+‚Äù.\n"
"3. –í—ã–±–µ—Ä–∏ ‚Äú–ò–º–ø–æ—Ä—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞‚Äù.\n"
"4. –í—Å—Ç–∞–≤—å –∫–ª—é—á –∏ –Ω–∞–∂–º–∏ ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.\n"
"5. –ù–∞–∂–º–∏ ‚Äú–°—Ç–∞—Ä—Ç‚Äù –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è."
)

how_windows =   (
"ü™ü <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Windows</b>:\n"
"1. –°–∫–∞—á–∞–π Hiddify —Å —Å–∞–π—Ç–∞ hiddify.com.\n"
"2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∏ –æ—Ç–∫—Ä–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—É.\n"
"3. –ù–∞–∂–º–∏ ‚Äú–ò–º–ø–æ—Ä—Ç ‚Üí –ò–∑ —Ç–µ–∫—Å—Ç–∞‚Äù.\n"
"4. –í—Å—Ç–∞–≤—å –∫–ª—é—á –∏ –Ω–∞–∂–º–∏ ‚Äú–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å‚Äù.\n"
"5. –ù–∞–∂–º–∏ ‚Äú–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è‚Äù."
)

how_macos = (
"üíª <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è MacOS</b>:\n"
"1. –£—Å—Ç–∞–Ω–æ–≤–∏ Hiddify —Å —Å–∞–π—Ç–∞ hiddify.com.\n"
"2. –û—Ç–∫—Ä–æ–π –∏ –Ω–∞–∂–º–∏ ‚Äú+‚Äù.\n"
"3. –í—ã–±–µ—Ä–∏ ‚Äú–ò–º–ø–æ—Ä—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞‚Äù.\n"
"4. –í—Å—Ç–∞–≤—å –∫–ª—é—á –∏ –Ω–∞–∂–º–∏ ‚Äú–î–æ–±–∞–≤–∏—Ç—å‚Äù.\n"
"5. –ù–∞–∂–º–∏ ‚Äú–°—Ç–∞—Ä—Ç‚Äù –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è."
)

how_to_dict = {
    how_to_callbacks.how_to_macos:how_macos,
    how_to_callbacks.how_to_windows:how_windows,
    how_to_callbacks.how_to_android:how_android,
    how_to_callbacks.how_to_ios:how_ios,
}

how_not_found = "‚ùó –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."


info = (
"Sosa VPN –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –Ω–∞–∏–ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, "
"–ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏. –í—Å–µ –Ω–∞—à–∏ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Å–Ω–∞—â–µ–Ω—ã –∫–∞–Ω–∞–ª–æ–º 1 –≥–±–∏—Ç/—Å.\n\n"
"–ñ—É—Ä–Ω–∞–ª –ª–æ–≥–æ–≤ —É–¥–∞–ª—è–µ—Ç—Å—è —Å –Ω–∞—à–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–µ—â–µ–Ω–∏–π, –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –º–Ω–æ–≥–∏—Ö "
"–±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –ú—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º –∏ –Ω–µ –ø—Ä–æ–¥–∞—ë–º –∫–∞–∫–∏–µ –ª–∏–±–æ –¥–∞–Ω–Ω—ã–µ –æ –í–∞—Å.\n\n"
"–î–ª—è –≤—ã–¥–∞—á–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ VPN –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telegram, –≤ —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º –Ω–∞—Å –Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å "
"–∏–∑ App Store –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫."
)

welcome_text = (
"–Ø –í–∞—à –ª–∏—á–Ω—ã–π –±–æ—Ç –∏ –ø–æ–º–æ—â–Ω–∏–∫ Sosa VPN!\n\n"
"–Ø –ø–æ–º–æ–≥–∞—é c –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –∑–∞—â–∏—Ç–æ–π –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.\n\n"
"–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏–≥–¥–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø—Ä–æ—Å—Ç–æ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è VPN.\n"
"–í—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ Telegram.")

connect_vpn_message = (
"‚ö°Ô∏è –í—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Sosa VPN.\n\n"
"‚Ä¢ –î–æ 5 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n"
"‚Ä¢ –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Ç—Ä–∞—Ñ–∏–∫—É"
)
not_enough_money_text = "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ."

choose_replenishment_method = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã'

notify_referrer = (
f"üéâ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ —Ç–≤–æ–µ–π —Å—Å—ã–ª–∫–µ!\n"
f"–¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ {REFERRAL_PROGRAMM_CONFIG.BONUS_TO_INVITER}‚ÇΩ."
)

notify_invited = (
    f"üéÅ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n"
    f"–¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ {REFERRAL_PROGRAMM_CONFIG.BONUS_TO_INVITED}‚ÇΩ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ."
)

def gen_balance_text():
    return ("—Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:\n\n\n" \
            "—Ç–∞—Ä–∏—Ñ—ã:\n\n\n")

def gen_connect_text(key,expiry_time):
    price = 3.33
    remaining_days = ceil((expiry_time - time.time()*1000)/1000/24/60/60)
    
    balance = ceil(remaining_days*price)
    expiry_date = date.fromtimestamp(expiry_time/1000)
    day = expiry_date.day
    month = expiry_date.month
    year = expiry_date.year
    expiry_date_text = f"{day}.{0 if month <10 else ""}{month}.{year}"
    #TODO FIX
    #TODO: add balance (with days)

    result_text =""
    if remaining_days>0:
        result_text+=f"–±–∞–ª–∞–Ω—Å <b>{balance}</b> —Ä—É–±–µ–ª–µ–π\n"
        result_text+=f"–æ—Å—Ç–∞–ª–æ—Å—å <b>{remaining_days}</b> –¥–Ω–µ–π\n"
        result_text+=f"–¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ <b>{expiry_date_text}</b>\n\n"
    else:
        result_text+="–Ω–µ –ø–æ–¥–Ω–ª—é—á–µ–Ω–æ, –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞\n\n"


    result_text += f"–≤–∞—à –∫–ª—é—á:\n<code>{key}</code>\n"

    
    return result_text
           


def profile_text(refs,user_id,botname):
    #TODO: remove balance
    return (
        f"–í–∞—à id: <b>{user_id}</b>\n"
        f"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: <b>{refs} —á–µ–ª.</b>\n\n"
        f"üîó –ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å 50‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å, –¥—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç 100‚ÇΩ.\n\n"
        f"üë• <b>–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n{gen_reflink(botname,user_id)}\n"
    )

instructions_text = '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'

def gen_reflink(botname,user_id):
    return f"https://t.me/{botname}?start={user_id}"


    
def gen_want_to_purshare_balance(days,cost):
    return (
        f"–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∫—É–ø–∏—Ç—å VPN –Ω–∞ {days} –¥–Ω–µ–π.\n"\
    	f"–° –≤–∞—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–æ {cost}‚ÇΩ."
    )

def gen_want_to_purshare_yokassa(days,cost,url):
    return 	(
        f"–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∫—É–ø–∏—Ç—å VPN –Ω–∞ {days} –¥–Ω–µ–π.\n"\
        f"–°—Ç–æ–∏–º–æ—Å—Ç—å: {cost}\n" \
        f"–°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã vpn:\n"\
        f"{url}"
        )

